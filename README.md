# LTI Sample

Это пример реализации ToolProvider-а на C# по стандарту LTI 1.0.

Чтобы встроить в курс на Edx свою нестандартную проверялку задач, нужно сделать следующее:

1. Создать новый веб-сервис (Tool Provider), который будет по запросу edx (или другой так называемый Tool Consumer), 
будет аутентифицировать edx и студента, отдавать html разметку проверялки задач, которую нужно встроить в iFrame edx-а, 
и после взаимодействия со студентом, отдельным запросом отправлять в edx набранные баллы.

2. При создании курса в Edx Studio, чтобы заработала интеграция с TP, нужно: ...
чего-то про URL TP, client_key, модули, ... см документацию.

Порядок работы Tool Provider-а:

1. Разработчик ToolProvider-а создает пару client_key и client_secret. Регистрирует их в Edx (где конкретно)?
В этом проекте client_key и client_secret хранятся в таблице Consumers и называются ConsumerKey и ConsumerSecret.

2. Браузер студента отправляет запрос к ToolProvider-e с аутентификационной информацией о студенте 
с подписью, сформированной сервером edx-а. 
Tool Provider проверяет подпись (OAuth) edx с использоваием client_key и client_secret 
(проверка реализована в LtiAuthenticationExtensions). 

3. Создание и аутентификация пользователя. 
Если пользователя нет в нашей базе, то он в неё добавляется, ему генерируется имя. 
Далее всё общение проходит с аутентифицированным пользователем (см. SecurityHandler).  
Все это реализовано в пакете LtiLibrary.AspNet.Identity.Owin, но по техническим причинам подключить его не получается.
Поэтому код скопирован из этого пакета в файл SecurityHandler и немного подправлен 
(изменили схему генерации имен пользователей и убраны мешающие зависимости пакета).

4. ToolProvider запоминает URL и ID запроса, по которому нужно отправлять баллы, после взаимодействия с пользователем.

5. В ответ на запрос edx, ToolProvider возвращает HTML (со ссылками на CSS и JS и тп), как это делает обычное веб-приложение.

6. В процессе работы ToolProvider решает зачесть задачу и отправить (или изменить) баллы в edx. (см. HomeController.SubmitScore). 
FullStack инсталляция Edx настроена неправильно — она просит отправить результаты на http**s**://**localhost**, 
при этом edx находится на другой виртульной машине, на которой не настроен https.
Сейчас в коде есть костыль для обхода этого бага.

TODO:
Ссылки:

1. На документацию по настройки edx-а для работы с тул-провайдером.
2. Статьи от автора пакета на C# про LTI.
3. На LTI стандарт.
4. На использованные пакеты.
